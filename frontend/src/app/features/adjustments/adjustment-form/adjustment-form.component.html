<div class="adjustment-form-container p-4 max-w-4xl mx-auto">
  <h1 class="text-2xl font-bold mb-6">Stock Adjustment</h1>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
    <div class="bg-white p-6 rounded-lg shadow">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Product *</mat-label>
          <input
            matInput
            formControlName="productId"
            [matAutocomplete]="productAuto"
            (input)="filterProducts($any($event.target).value || '')" />
          <mat-autocomplete #productAuto="matAutocomplete">
            @for (product of filteredProducts(); track product.id) {
              <mat-option [value]="product.id">{{ product.name }} ({{ product.sku }})</mat-option>
            }
          </mat-autocomplete>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Batch (Optional)</mat-label>
          <mat-select formControlName="batchId">
            <mat-option [value]="undefined">All Batches</mat-option>
            @for (batch of batches(); track batch.id) {
              <mat-option [value]="batch.id">
                {{ batch.batchNumber }} (Qty: {{ batch.quantity }}, Exp: @if (batch.expiryDate) { {{ batch.expiryDate | date: 'short' }} } @else { N/A })
              </mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Adjustment Type *</mat-label>
          <mat-select formControlName="adjustmentType">
            @for (type of adjustmentTypes; track type.value) {
              <mat-option [value]="type.value">{{ type.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Quantity Change *</mat-label>
          <input matInput type="number" formControlName="quantityChange" />
          <mat-hint>Positive for increase, negative for decrease</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full md:col-span-2">
          <mat-label>Reason *</mat-label>
          <input matInput formControlName="reason" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Linked GRN ID (Optional)</mat-label>
          <input matInput formControlName="linkedGRNId" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Linked Sale ID (Optional)</mat-label>
          <input matInput formControlName="linkedSaleId" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full md:col-span-2">
          <mat-label>Notes</mat-label>
          <textarea matInput formControlName="notes" rows="3"></textarea>
        </mat-form-field>
      </div>
    </div>

    <div class="flex justify-end gap-4">
      <button type="button" mat-button (click)="onCancel()">Cancel</button>
      <button type="submit" mat-raised-button color="primary" [disabled]="loading() || form.invalid">
        @if (loading()) {
          <mat-spinner diameter="20"></mat-spinner>
        } @else {
          Create Adjustment
        }
      </button>
    </div>
  </form>
</div>

