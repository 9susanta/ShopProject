<div class="pos-container h-screen flex flex-col">
  <!-- Header -->
  <header class="header-gradient shadow-sm px-6 py-4" style="border-bottom: 1px solid var(--gray-200);">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-bold" style="color: white;">Point of Sale</h1>
      <div class="flex items-center gap-4">
        <grocery-barcode-input (barcodeScanned)="onBarcodeScanned($event)"></grocery-barcode-input>
        <button
          class="btn-gradient-secondary px-4 py-2 rounded-lg"
          [class.badge-gradient-notification]="isVoiceListening()"
          (click)="toggleVoiceListening()"
          [attr.aria-label]="isVoiceListening() ? 'Stop voice commands' : 'Start voice commands'"
        >
          <span class="material-icons mr-2">{{ isVoiceListening() ? 'mic' : 'mic_off' }}</span>
          {{ isVoiceListening() ? 'Listening...' : 'Voice' }}
        </button>
      </div>
    </div>
  </header>

  <div class="flex-1 flex overflow-hidden">
    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-6">
      <!-- Search and Filters -->
      <div class="mb-6">
        <div class="pos-search-filter-container">
          <div class="search-input-wrapper">
            <span class="material-icons search-icon">search</span>
            <input
              type="text"
              [value]="searchTerm()"
              (input)="onSearchChange($any($event.target).value)"
              placeholder="Search products by name, SKU, barcode, or description..."
              class="pos-search-input"
              [attr.aria-label]="'Search products'"
            />
            @if (searchTerm()) {
              <button
                type="button"
                class="clear-search-btn"
                (click)="onSearchChange('')"
                [attr.aria-label]="'Clear search'"
              >
                <span class="material-icons">close</span>
              </button>
            }
          </div>
          <grocery-category-multiselect
            [categories]="categories()"
            [selectedCategoryIds]="selectedCategoryIds()"
            placeholder="All Categories"
            (selectionChange)="onCategorySelectionChange($event)"
          ></grocery-category-multiselect>
        </div>
        @if (searchTerm()) {
          <div class="search-results-info">
            <span class="material-icons">info</span>
            <span>Found {{ filteredProducts().length }} product(s) matching "{{ searchTerm() }}"</span>
          </div>
        }
      </div>

      <!-- Products Grid - Kiosk Style -->
      <div class="products-grid kiosk-style">
        @for (product of filteredProducts(); track product.id) {
          <grocery-product-tile-kiosk
            [product]="product"
            [cartQuantity]="getCartQuantity(product.id)"
            [isOutOfStock]="isOutOfStock(product)"
            [isLowStock]="isLowStock(product)"
            (addToCart)="onAddToCart({product: $event, quantity: 1})"
            (increment)="incrementProductQuantity($event)"
            (decrement)="decrementProductQuantity($event)"
            (tileClick)="onTileClick($event.product, $event.event)"
          ></grocery-product-tile-kiosk>
        }
      </div>

      @if (filteredProducts().length === 0) {
        <div class="empty-state-kiosk">
          <span class="material-icons">inventory_2</span>
          <p>No products found</p>
        </div>
      }
    </main>

    <!-- Cart Sidebar -->
    <grocery-cart-sidebar
      [cart]="cart()"
      [customerPhone]="customerPhone()"
      [lastSaleResponse]="lastSaleResponse()"
      [cartTotal]="cartTotal()"
      [cartItemCount]="cartItemCount()"
      [unlimitedQuantity]="UNLIMITED_QUANTITY"
      [showCheckoutModal]="showCheckoutModal()"
      (removeItem)="removeFromCart($event)"
      (quantityChange)="onQuantityChange($event.item, $event.quantity)"
      (checkout)="onCheckout()"
      (phoneChange)="customerPhone.set($event)"
      (downloadInvoice)="downloadInvoice()"
    ></grocery-cart-sidebar>
  </div>

  <!-- Checkout Modal -->
  @if (showCheckoutModal()) {
    <grocery-checkout-modal
      [cart]="cart()"
      (complete)="onCheckoutComplete($event)"
      (cancel)="onCheckoutCancel()"
    ></grocery-checkout-modal>
  }
</div>


