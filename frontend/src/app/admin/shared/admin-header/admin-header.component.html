<header class="admin-header">
  <div class="header-content">
    <!-- Logo/Brand -->
    <div class="header-brand">
      <a routerLink="/admin/dashboard" class="brand-link">
        <span class="material-icons brand-icon">store</span>
        <span class="brand-text">Grocery Store</span>
      </a>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" aria-label="Toggle menu" type="button">
      <span class="material-icons">menu</span>
    </button>

    <!-- Navigation Menu -->
    <nav class="header-nav" [class.mobile-open]="isMobileMenuOpen()">
      <!-- Dashboard (Single Item) -->
      <a 
        routerLink="/admin/dashboard" 
        routerLinkActive="active"
        [routerLinkActiveOptions]="{exact: true}"
        class="nav-link"
        (click)="closeMobileMenu()">
        <span class="material-icons nav-icon">dashboard</span>
        <span class="nav-label">Dashboard</span>
      </a>

      <!-- Master Data (Dropdown) -->
      @if (canAccessMenu('master')) {
        <div class="nav-dropdown" 
             [class.open]="openDropdown() === 'master'"
             (mouseenter)="onDropdownMouseEnter('master')"
             (mouseleave)="onDropdownMouseLeave('master', $event)">
          <button class="nav-link dropdown-trigger" 
                  (click)="toggleDropdown('master'); $event.stopPropagation()"
                  [attr.aria-expanded]="openDropdown() === 'master'"
                  type="button">
            <span class="material-icons nav-icon">category</span>
            <span class="nav-label">Master Data</span>
            <span class="material-icons dropdown-arrow">keyboard_arrow_down</span>
          </button>
          <div class="dropdown-menu"
               (mouseenter)="onDropdownMenuMouseEnter('master')"
               (mouseleave)="onDropdownMenuMouseLeave('master')"
               (click)="$event.stopPropagation()">
            <a routerLink="/admin/master/categories" class="dropdown-item" (click)="closeMobileMenu(); $event.stopPropagation()">
              <span class="material-icons">label</span>
              <span>Categories</span>
            </a>
            <a routerLink="/admin/master/units" class="dropdown-item" (click)="closeMobileMenu(); $event.stopPropagation()">
              <span class="material-icons">straighten</span>
              <span>Units</span>
            </a>
            <a routerLink="/admin/master/tax-slabs" class="dropdown-item" (click)="closeMobileMenu(); $event.stopPropagation()">
              <span class="material-icons">percent</span>
              <span>Tax Slabs</span>
            </a>
            <div class="dropdown-divider"></div>
            <a routerLink="/admin/products" class="dropdown-item" (click)="closeMobileMenu(); $event.stopPropagation()">
              <span class="material-icons">inventory_2</span>
              <span>Products</span>
            </a>
            <a routerLink="/admin/suppliers" class="dropdown-item" (click)="closeMobileMenu(); $event.stopPropagation()">
              <span class="material-icons">business</span>
              <span>Suppliers</span>
            </a>
            <a routerLink="/admin/customers" class="dropdown-item" (click)="closeMobileMenu(); $event.stopPropagation()">
              <span class="material-icons">people</span>
              <span>Customers</span>
            </a>
          </div>
        </div>
      }

      <!-- Customers (Single Item) -->
      <a 
        routerLink="/admin/customers" 
        routerLinkActive="active"
        [routerLinkActiveOptions]="{exact: false}"
        class="nav-link"
        (click)="closeMobileMenu()">
        <span class="material-icons nav-icon">people</span>
        <span class="nav-label">Customers</span>
      </a>

      <!-- Inventory (Dropdown) -->
      <div class="nav-dropdown" 
           [class.open]="openDropdown() === 'inventory'"
           (mouseenter)="onDropdownMouseEnter('inventory')"
           (mouseleave)="onDropdownMouseLeave('inventory', $event)">
        <button class="nav-link dropdown-trigger" 
                (click)="toggleDropdown('inventory'); $event.stopPropagation()"
                [attr.aria-expanded]="openDropdown() === 'inventory'"
                type="button">
          <span class="material-icons nav-icon">warehouse</span>
          <span class="nav-label">Inventory</span>
          <span class="material-icons dropdown-arrow">keyboard_arrow_down</span>
        </button>
        <div class="dropdown-menu"
             (mouseenter)="onDropdownMenuMouseEnter('inventory')"
             (mouseleave)="onDropdownMenuMouseLeave('inventory')"
             (click)="$event.stopPropagation()">
          <a routerLink="/admin/inventory" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">dashboard</span>
            <span>Stock Summary</span>
          </a>
          <a routerLink="/admin/inventory/products" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">inventory</span>
            <span>Batches</span>
          </a>
          <a routerLink="/admin/inventory/expiry" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">event_busy</span>
            <span>Expiry List</span>
          </a>
          <a routerLink="/admin/inventory/adjust" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">tune</span>
            <span>Adjust Stock</span>
          </a>
          <a routerLink="/admin/reports/slow-moving" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">trending_down</span>
            <span>Slow-Moving Items</span>
          </a>
        </div>
      </div>

      <!-- Purchasing (Dropdown) -->
      <div class="nav-dropdown" 
           [class.open]="openDropdown() === 'purchasing'"
           (mouseenter)="onDropdownMouseEnter('purchasing')"
           (mouseleave)="onDropdownMouseLeave('purchasing', $event)">
        <button class="nav-link dropdown-trigger" 
                (click)="toggleDropdown('purchasing'); $event.stopPropagation()"
                [attr.aria-expanded]="openDropdown() === 'purchasing'"
                type="button">
          <span class="material-icons nav-icon">shopping_cart</span>
          <span class="nav-label">Purchasing</span>
          <span class="material-icons dropdown-arrow">keyboard_arrow_down</span>
        </button>
        <div class="dropdown-menu"
             (mouseenter)="onDropdownMenuMouseEnter('purchasing')"
             (mouseleave)="onDropdownMenuMouseLeave('purchasing')"
             (click)="$event.stopPropagation()">
          <a routerLink="/admin/purchasing/purchase-orders" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">receipt_long</span>
            <span>Purchase Orders</span>
          </a>
          <a routerLink="/admin/purchasing/grn" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">inventory</span>
            <span>GRN</span>
          </a>
          <a routerLink="/admin/purchasing/supplier-returns" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">assignment_return</span>
            <span>Supplier Returns</span>
          </a>
          <a routerLink="/admin/suppliers/payments" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">payment</span>
            <span>Supplier Payments</span>
          </a>
        </div>
      </div>

      <!-- Sales / POS (Dropdown) -->
      <div class="nav-dropdown" 
           [class.open]="openDropdown() === 'sales'"
           (mouseenter)="onDropdownMouseEnter('sales')"
           (mouseleave)="onDropdownMouseLeave('sales', $event)">
        <button class="nav-link dropdown-trigger" 
                (click)="toggleDropdown('sales'); $event.stopPropagation()"
                [attr.aria-expanded]="openDropdown() === 'sales'"
                type="button">
          <span class="material-icons nav-icon">point_of_sale</span>
          <span class="nav-label">Sales / POS</span>
          <span class="material-icons dropdown-arrow">keyboard_arrow_down</span>
        </button>
        <div class="dropdown-menu"
             (mouseenter)="onDropdownMenuMouseEnter('sales')"
             (mouseleave)="onDropdownMenuMouseLeave('sales')"
             (click)="$event.stopPropagation()">
          <a routerLink="/pos" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">shopping_cart</span>
            <span>POS (Self Service)</span>
          </a>
          <a routerLink="/pos" [queryParams]="{mode: 'assist'}" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">person</span>
            <span>POS (Salesboy Assist)</span>
          </a>
          <a routerLink="/admin/sales" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">list</span>
            <span>Sales List</span>
          </a>
        </div>
      </div>

      <!-- Offers & Discounts (Dropdown) -->
      <div class="nav-dropdown" 
           [class.open]="openDropdown() === 'offers'"
           (mouseenter)="onDropdownMouseEnter('offers')"
           (mouseleave)="onDropdownMouseLeave('offers', $event)">
        <button class="nav-link dropdown-trigger" 
                (click)="toggleDropdown('offers'); $event.stopPropagation()"
                [attr.aria-expanded]="openDropdown() === 'offers'"
                type="button">
          <span class="material-icons nav-icon">local_offer</span>
          <span class="nav-label">Offers</span>
          <span class="material-icons dropdown-arrow">keyboard_arrow_down</span>
        </button>
        <div class="dropdown-menu"
             (mouseenter)="onDropdownMenuMouseEnter('offers')"
             (mouseleave)="onDropdownMenuMouseLeave('offers')"
             (click)="$event.stopPropagation()">
          <a routerLink="/admin/offers" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">list</span>
            <span>Offer List</span>
          </a>
          <a routerLink="/admin/offers/new" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">add</span>
            <span>Create Offer</span>
          </a>
        </div>
      </div>

      <!-- Reports (Dropdown) -->
      <div class="nav-dropdown" 
           [class.open]="openDropdown() === 'reports'"
           (mouseenter)="onDropdownMouseEnter('reports')"
           (mouseleave)="onDropdownMouseLeave('reports', $event)">
        <button class="nav-link dropdown-trigger" 
                (click)="toggleDropdown('reports'); $event.stopPropagation()"
                [attr.aria-expanded]="openDropdown() === 'reports'"
                type="button">
          <span class="material-icons nav-icon">assessment</span>
          <span class="nav-label">Reports</span>
          <span class="material-icons dropdown-arrow">keyboard_arrow_down</span>
        </button>
        <div class="dropdown-menu"
             (mouseenter)="onDropdownMenuMouseEnter('reports')"
             (mouseleave)="onDropdownMenuMouseLeave('reports')"
             (click)="$event.stopPropagation()">
          <a routerLink="/admin/reports/daily-sales" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">today</span>
            <span>Daily Sales</span>
          </a>
          <a routerLink="/admin/reports/item-wise-sales" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">bar_chart</span>
            <span>Item-wise Sales</span>
          </a>
          <a routerLink="/admin/reports/purchase-summary" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">shopping_bag</span>
            <span>Purchase Summary</span>
          </a>
          <a routerLink="/admin/reports/low-stock" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">warning</span>
            <span>Low Stock Report</span>
          </a>
          <a routerLink="/admin/reports/expiry" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">event_busy</span>
            <span>Expiry Report</span>
          </a>
          <a routerLink="/admin/reports/gst-summary" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">receipt</span>
            <span>GST Monthly</span>
          </a>
          <a routerLink="/admin/reports/slow-moving" class="dropdown-item" (click)="closeMobileMenu()">
            <span class="material-icons">trending_down</span>
            <span>Slow-Moving Products</span>
          </a>
        </div>
      </div>

      <!-- Tools (Dropdown) -->
      @if (canAccessMenu('tools')) {
        <div class="nav-dropdown" 
             [class.open]="openDropdown() === 'tools'"
             (mouseenter)="onDropdownMouseEnter('tools')"
             (mouseleave)="onDropdownMouseLeave('tools', $event)">
          <button class="nav-link dropdown-trigger" 
                  (click)="toggleDropdown('tools'); $event.stopPropagation()"
                  [attr.aria-expanded]="openDropdown() === 'tools'"
                  type="button">
            <span class="material-icons nav-icon">build</span>
            <span class="nav-label">Tools</span>
            <span class="material-icons dropdown-arrow">keyboard_arrow_down</span>
          </button>
          <div class="dropdown-menu"
               (mouseenter)="onDropdownMenuMouseEnter('tools')"
               (mouseleave)="onDropdownMenuMouseLeave('tools')"
               (click)="$event.stopPropagation()">
            <a routerLink="/admin/tools/barcode-printing" class="dropdown-item" (click)="closeMobileMenu()">
              <span class="material-icons">qr_code</span>
              <span>Barcode Printing</span>
            </a>
            <a routerLink="/admin/tools/weight-machine" class="dropdown-item" (click)="closeMobileMenu()">
              <span class="material-icons">monitor_weight</span>
              <span>Weight Machine Test</span>
            </a>
            <a routerLink="/admin/imports" class="dropdown-item" (click)="closeMobileMenu()">
              <span class="material-icons">upload_file</span>
              <span>Bulk Import (Excel)</span>
            </a>
          </div>
        </div>
      }

      <!-- Settings (Dropdown) -->
      @if (canAccessMenu('settings')) {
        <div class="nav-dropdown" 
             [class.open]="openDropdown() === 'settings'"
             (mouseenter)="onDropdownMouseEnter('settings')"
             (mouseleave)="onDropdownMouseLeave('settings', $event)">
          <button class="nav-link dropdown-trigger" 
                  (click)="toggleDropdown('settings'); $event.stopPropagation()"
                  [attr.aria-expanded]="openDropdown() === 'settings'"
                  type="button">
            <span class="material-icons nav-icon">settings</span>
            <span class="nav-label">Settings</span>
            <span class="material-icons dropdown-arrow">keyboard_arrow_down</span>
          </button>
          <div class="dropdown-menu"
               (mouseenter)="onDropdownMenuMouseEnter('settings')"
               (mouseleave)="onDropdownMenuMouseLeave('settings')"
               (click)="$event.stopPropagation()">
            <a routerLink="/admin/settings/roles" class="dropdown-item" (click)="closeMobileMenu()">
              <span class="material-icons">people</span>
              <span>User Management</span>
            </a>
            <a routerLink="/admin/settings/roles" class="dropdown-item" (click)="closeMobileMenu()">
              <span class="material-icons">admin_panel_settings</span>
              <span>Roles & Permissions</span>
            </a>
            <a routerLink="/admin/settings" class="dropdown-item" (click)="closeMobileMenu()">
              <span class="material-icons">store</span>
              <span>Store Settings</span>
            </a>
          </div>
        </div>
      }
    </nav>

    <!-- User Profile Section -->
    <div class="header-profile">
      <div class="profile-container" (click)="toggleProfileMenu()">
        <div class="profile-avatar">
          <span class="material-icons">account_circle</span>
        </div>
        <div class="profile-info">
          <span class="profile-name">{{ userName() }}</span>
          <span class="profile-role">{{ userRole() }}</span>
        </div>
        <span class="material-icons dropdown-icon" [class.rotated]="isProfileMenuOpen()">
          keyboard_arrow_down
        </span>
      </div>

      <!-- Profile Dropdown Menu -->
      @if (isProfileMenuOpen()) {
        <div class="profile-menu" (click)="$event.stopPropagation()">
          <div class="profile-menu-header">
            <div class="profile-menu-avatar">
              <span class="material-icons">account_circle</span>
            </div>
            <div class="profile-menu-info">
              <div class="profile-menu-name">{{ userName() }}</div>
              <div class="profile-menu-email">{{ userEmail() }}</div>
              <div class="profile-menu-role">{{ userRole() }}</div>
            </div>
          </div>
          <div class="profile-menu-divider"></div>
          <button class="profile-menu-item" (click)="navigateToProfile(); $event.stopPropagation()">
            <span class="material-icons">person</span>
            <span>My Profile</span>
          </button>
          <button class="profile-menu-item" (click)="navigateToProfile(); $event.stopPropagation()">
            <span class="material-icons">settings</span>
            <span>Account Settings</span>
          </button>
          <div class="profile-menu-divider"></div>
          <button 
            class="profile-menu-item logout" 
            type="button" 
            (click)="handleLogout($event)"
            [disabled]="false"
            aria-label="Logout">
            <span class="material-icons">logout</span>
            <span>Logout</span>
          </button>
        </div>
      }
    </div>
  </div>
</header>

<!-- Click outside to close menu - Removed overlay as it was blocking logout button clicks -->
<!-- Using document click handler instead (see component.ts) -->

