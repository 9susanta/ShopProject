<div class="import-upload-container p-6">
  <div class="mb-6">
    <h1 class="text-3xl font-bold" style="color: var(--gray-900);">Import Products</h1>
    <p class="mt-2" style="color: var(--gray-600);">Upload Excel or JSON file to import products</p>
  </div>

  <!-- File Upload -->
  <div class="container-gradient p-6 rounded-lg mb-6">
    <h2 class="text-xl font-semibold mb-4" style="color: var(--gray-900);">Step 1: Upload File</h2>
    <grocery-file-import
      (fileSelected)="onFileSelected($event)"
      (previewReady)="onPreviewReady($event)"
    ></grocery-file-import>
    <div class="mt-4">
      <button
        class="btn-gradient-primary px-4 py-2 rounded-lg"
        (click)="uploadFile()"
        [disabled]="!selectedFile() || isUploading()"
        [attr.aria-label]="'Upload file'"
      >
        <span *ngIf="!isUploading()">Upload File</span>
        <span *ngIf="isUploading()">Uploading...</span>
      </button>
    </div>
  </div>

  <!-- Mapping Form -->
  <div *ngIf="preview() && currentJobId()" class="container-gradient p-6 rounded-lg mb-6">
    <h2 class="text-xl font-semibold mb-4" style="color: var(--gray-900);">Step 2: Map Columns</h2>
    <p class="text-sm mb-4" style="color: var(--gray-600);">
      Map each column from your file to the corresponding product field
    </p>
    <div class="space-y-3">
      <div
        *ngFor="let header of preview()!.headers"
        class="flex items-center gap-4 p-3 rounded-lg"
        style="border: 1px solid var(--gray-200); background: linear-gradient(to right, white, var(--gray-50));"
      >
        <label class="w-48 font-medium" style="color: var(--gray-900);">{{ header }}</label>
        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Product Field</mat-label>
          <mat-select [value]="getMappingValue(header)" (selectionChange)="setMappingValue(header, $event.value)">
            <mat-option [value]="''">-- Skip --</mat-option>
            <mat-option *ngFor="let field of productFields" [value]="field">
              {{ field }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="mt-6">
      <button
        class="btn-gradient-primary px-4 py-2 rounded-lg"
        (click)="startImport()"
        [disabled]="isImporting()"
        [attr.aria-label]="'Start import'"
      >
        <span *ngIf="!isImporting()">Start Import</span>
        <span *ngIf="isImporting()">Importing...</span>
      </button>
    </div>
  </div>

  <!-- Progress -->
  <div *ngIf="isImporting() || importStatus()" class="container-gradient p-6 rounded-lg mb-6">
    <h2 class="text-xl font-semibold mb-4" style="color: var(--gray-900);">Import Progress</h2>
    <div *ngIf="isImporting()" class="mb-4">
      <mat-progress-bar mode="determinate" [value]="progress()" class="progress-gradient"></mat-progress-bar>
      <p class="text-sm mt-2" style="color: var(--gray-600);">{{ progress() }}% complete</p>
    </div>
    <div *ngIf="importStatus()" class="space-y-2">
      <div class="flex items-center justify-between">
        <span class="text-sm" style="color: var(--gray-600);">Status:</span>
        <span
          class="px-3 py-1 text-sm rounded font-medium text-white"
          [ngClass]="{
            'status-gradient-success': importStatus()!.status === 'Completed',
            'status-gradient-warning': importStatus()!.status === 'Processing',
            'status-gradient-error': importStatus()!.status === 'Failed',
            'status-gradient-info': importStatus()!.status === 'Pending'
          }"
        >
          {{ importStatus()!.status }}
        </span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-sm" style="color: var(--gray-600);">Processed:</span>
        <span class="text-sm font-medium">
          {{ importStatus()!.processedRows }} / {{ importStatus()!.totalRows }}
        </span>
      </div>
      <div *ngIf="importStatus()!.successRows > 0" class="flex items-center justify-between">
        <span class="text-sm" style="color: var(--gray-600);">Success:</span>
        <span class="text-sm font-medium" style="color: var(--vivid-pink);">{{ importStatus()!.successRows }}</span>
      </div>
      <div *ngIf="importStatus()!.errorRows > 0" class="flex items-center justify-between">
        <span class="text-sm" style="color: var(--gray-600);">Errors:</span>
        <span class="text-sm font-medium" style="color: var(--hot-red);">{{ importStatus()!.errorRows }}</span>
      </div>
    </div>
  </div>

  <!-- Errors -->
  <div *ngIf="errors().length > 0" class="container-gradient p-6 rounded-lg mb-6" style="border: 2px solid var(--light-pink); background: linear-gradient(135deg, var(--light-pink), var(--gray-100));">
    <h3 class="text-lg font-semibold mb-2" style="color: var(--gray-900);">Errors</h3>
    <ul class="list-disc list-inside space-y-1">
      <li *ngFor="let error of errors()" class="text-sm" style="color: var(--gray-900);">{{ error }}</li>
    </ul>
  </div>

  <!-- Reset Button -->
  <div *ngIf="importStatus() && (importStatus()!.status === 'Completed' || importStatus()!.status === 'Failed')">
    <button class="btn-gradient-secondary px-4 py-2 rounded-lg" (click)="reset()" [attr.aria-label]="'Reset and start new import'">
      Start New Import
    </button>
  </div>
</div>


