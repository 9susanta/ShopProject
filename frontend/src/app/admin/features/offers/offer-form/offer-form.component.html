<div class="admin-page-container">
  <div class="admin-page-header">
    <h1>{{ isEditMode() ? 'Edit Offer' : 'New Offer' }}</h1>
    <div class="header-actions">
      <button mat-button (click)="cancel()">Cancel</button>
    </div>
  </div>
  <div class="admin-page-content">
    <form [formGroup]="offerForm" (ngSubmit)="onSubmit()" class="offer-form">
      <div class="form-grid">
        <!-- Basic Information -->
        <div class="form-section">
          <h2>Basic Information</h2>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Offer Name *</mat-label>
            <input matInput formControlName="name" placeholder="Enter offer name" />
            @if (offerForm.get('name')?.invalid && offerForm.get('name')?.touched) {
              <mat-error>Offer name is required (min 3 characters)</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description" rows="3" placeholder="Enter offer description"></textarea>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Offer Type *</mat-label>
            <mat-select formControlName="type">
              @for (option of offerTypeOptions; track option.value) {
                <mat-option [value]="option.value">{{ option.label }}</mat-option>
              }
            </mat-select>
            @if (offerForm.get('type')?.invalid && offerForm.get('type')?.touched) {
              <mat-error>Offer type is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Discount Value *</mat-label>
            <input matInput type="number" formControlName="discountValue" min="0" step="0.01" />
            <span matSuffix>
              @if (offerForm.get('type')?.value === OfferType.PercentageDiscount) {
                %
              } @else {
                â‚¹
              }
            </span>
            @if (offerForm.get('discountValue')?.invalid && offerForm.get('discountValue')?.touched) {
              <mat-error>Discount value is required and must be >= 0</mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Scope & Conditions -->
        <div class="form-section">
          <h2>Scope & Conditions</h2>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Scope</mat-label>
            <mat-select [value]="scopeType()" (selectionChange)="scopeType.set($event.value); onScopeTypeChange()">
              <mat-option value="store">Store-wide</mat-option>
              <mat-option value="category">Category</mat-option>
              <mat-option value="product">Product</mat-option>
            </mat-select>
          </mat-form-field>

          @if (scopeType() === 'category') {
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Category *</mat-label>
              <mat-select formControlName="categoryId">
                <mat-option [value]="null">Select Category</mat-option>
                @for (category of categories(); track category.id) {
                  <mat-option [value]="category.id">{{ category.name }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          }

          @if (scopeType() === 'product') {
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Product *</mat-label>
              <mat-select formControlName="productId">
                <mat-option [value]="null">Select Product</mat-option>
                @for (product of products(); track product.id) {
                  <mat-option [value]="product.id">{{ product.name }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          }

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Coupon Code (Optional)</mat-label>
            <input matInput formControlName="couponCode" placeholder="Enter coupon code" />
            <mat-hint>Leave empty for auto-apply offers</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Minimum Quantity</mat-label>
            <input matInput type="number" formControlName="minQuantity" min="1" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Maximum Quantity</mat-label>
            <input matInput type="number" formControlName="maxQuantity" min="1" />
          </mat-form-field>
        </div>

        <!-- Validity Period -->
        <div class="form-section">
          <h2>Validity Period</h2>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Start Date *</mat-label>
            <input matInput [matDatepicker]="startPicker" formControlName="startDate" />
            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
            @if (offerForm.get('startDate')?.invalid && offerForm.get('startDate')?.touched) {
              <mat-error>Start date is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>End Date *</mat-label>
            <input matInput [matDatepicker]="endPicker" formControlName="endDate" />
            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
            @if (offerForm.get('endDate')?.invalid && offerForm.get('endDate')?.touched) {
              <mat-error>End date is required</mat-error>
            }
          </mat-form-field>

          <mat-checkbox formControlName="isActive">Active</mat-checkbox>
        </div>
      </div>

      <div class="form-actions">
        <button mat-button type="button" (click)="cancel()">Cancel</button>
        <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting() || offerForm.invalid">
          @if (isSubmitting()) {
            <mat-spinner diameter="20"></mat-spinner>
            Saving...
          } @else {
            {{ isEditMode() ? 'Update Offer' : 'Create Offer' }}
          }
        </button>
      </div>
    </form>
  </div>
</div>

