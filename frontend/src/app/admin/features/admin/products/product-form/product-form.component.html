<div class="admin-page-container">
  <div class="admin-page-header">
    <h1>{{ isEditMode() ? 'Edit Product' : 'New Product' }}</h1>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="cancel()">Cancel</button>
    </div>
  </div>
  <div class="admin-page-content">

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
    <div class="form-grid">
      <!-- Basic Information -->
      <div class="form-section">
        <h2>Basic Information</h2>
        
        <div class="form-group">
          <label for="name" class="form-label">Product Name *</label>
          <input
            id="name"
            type="text"
            class="form-control"
            formControlName="name"
            placeholder="Enter product name"
            [class.error]="productForm.get('name')?.invalid && productForm.get('name')?.touched"
          />
          @if (productForm.get('name')?.invalid && productForm.get('name')?.touched) {
            <span class="form-error">Product name is required (min 3 characters)</span>
          }
        </div>

        <div class="form-group">
          <label for="sku" class="form-label">SKU *</label>
          <input
            id="sku"
            type="text"
            class="form-control"
            formControlName="sku"
            placeholder="Enter SKU"
            [class.error]="productForm.get('sku')?.invalid && productForm.get('sku')?.touched"
          />
          @if (productForm.get('sku')?.invalid && productForm.get('sku')?.touched) {
            <span class="form-error">SKU is required</span>
          }
        </div>

        <div class="form-group">
          <label for="barcode" class="form-label">Barcode</label>
          <input
            id="barcode"
            type="text"
            class="form-control"
            formControlName="barcode"
            placeholder="Scan or enter barcode"
          />
          <p class="hint">Scan barcode using scanner or enter manually</p>
        </div>

        <div class="form-group">
          <label for="description" class="form-label">Description</label>
          <textarea
            id="description"
            class="form-control"
            formControlName="description"
            rows="4"
            placeholder="Enter product description"
          ></textarea>
        </div>
      </div>

      <!-- Pricing -->
      <div class="form-section">
        <h2>Pricing</h2>
        
        <div class="form-group">
          <label for="mrp" class="form-label">MRP (₹) *</label>
          <input
            id="mrp"
            type="number"
            class="form-control"
            formControlName="mrp"
            min="0"
            step="0.01"
            [class.error]="productForm.get('mrp')?.invalid && productForm.get('mrp')?.touched"
          />
          @if (productForm.get('mrp')?.invalid && productForm.get('mrp')?.touched) {
            <span class="form-error">MRP is required and must be >= 0</span>
          }
        </div>

        <div class="form-group">
          <label for="salePrice" class="form-label">Sale Price (₹) *</label>
          <input
            id="salePrice"
            type="number"
            class="form-control"
            formControlName="salePrice"
            min="0"
            step="0.01"
            [class.error]="productForm.get('salePrice')?.invalid && productForm.get('salePrice')?.touched"
          />
          @if (productForm.get('salePrice')?.invalid && productForm.get('salePrice')?.touched) {
            <span class="form-error">Sale price is required and must be >= 0</span>
          }
        </div>

        <div class="form-group">
          <label for="gstRate" class="form-label">GST Rate (%)</label>
          <input
            id="gstRate"
            type="number"
            class="form-control"
            formControlName="gstRate"
            min="0"
            max="100"
            step="0.01"
          />
        </div>
      </div>

      <!-- Inventory & Category -->
      <div class="form-section">
        <h2>Inventory & Category</h2>
        
        <mat-form-field appearance="outline">
          <mat-label>Category *</mat-label>
          <mat-select
            formControlName="categoryId"
            id="categoryId"
            [class.error]="productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched">
            @for (category of categories(); track category.id) {
              <mat-option [value]="category.id">
                {{ category.name }}
                @if (category.taxSlab) {
                  ({{ category.taxSlab.rate }}%)
                }
              </mat-option>
            }
          </mat-select>
          @if (productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched) {
            <mat-error>Category is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Tax Slab</mat-label>
          <mat-select
            formControlName="taxSlabId"
            id="taxSlabId">
            @for (taxSlab of taxSlabs(); track taxSlab.id) {
              <mat-option [value]="taxSlab.id">
                {{ taxSlab.name }} ({{ taxSlab.rate }}%)
              </mat-option>
            }
          </mat-select>
          <mat-hint>Auto-filled from category, but can be overridden</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Unit *</mat-label>
          <mat-select
            formControlName="unitId"
            id="unitId"
            [class.error]="productForm.get('unitId')?.invalid && productForm.get('unitId')?.touched">
            @for (unit of units(); track unit.id) {
              <mat-option [value]="unit.id">
                {{ unit.name }} ({{ unit.symbol }})
              </mat-option>
            }
          </mat-select>
          @if (productForm.get('unitId')?.invalid && productForm.get('unitId')?.touched) {
            <mat-error>Unit is required</mat-error>
          }
        </mat-form-field>

        <div class="form-group">
          <label for="lowStockThreshold" class="form-label">Low Stock Threshold *</label>
          <input
            id="lowStockThreshold"
            type="number"
            class="form-control"
            formControlName="lowStockThreshold"
            min="0"
            [class.error]="productForm.get('lowStockThreshold')?.invalid && productForm.get('lowStockThreshold')?.touched"
          />
        </div>

        <div class="form-group">
          <label for="supplierId" class="form-label">Supplier</label>
          <input
            id="supplierId"
            type="text"
            class="form-control"
            formControlName="supplierId"
            placeholder="Enter supplier ID"
          />
        </div>
      </div>

      <!-- Image Upload -->
      <div class="form-section">
        <h2>Product Image</h2>
        
        <div class="image-upload">
          @if (imagePreview()) {
            <div class="image-preview">
              <img [src]="imagePreview()!" alt="Product preview" />
              <button
                type="button"
                class="btn-remove-image"
                (click)="selectedImage.set(null); imagePreview.set(null)">
                <span class="material-icons">close</span>
              </button>
            </div>
          }
          
          <label for="image" class="upload-label">
            <span class="material-icons">cloud_upload</span>
            @if (imagePreview()) {
              Change Image
            } @else {
              Upload Image
            }
          </label>
          <input
            id="image"
            type="file"
            accept="image/*"
            (change)="onImageSelected($event)"
            style="display: none;"
          />
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="productForm.invalid || isSubmitting()">
        @if (isSubmitting()) {
          Saving...
        } @else {
          Save
        }
      </button>
    </div>
  </form>
  </div>
</div>

