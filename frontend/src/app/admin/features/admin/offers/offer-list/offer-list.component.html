<div class="offer-list-container p-4">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-semibold">Offers Management</h2>
    <button mat-raised-button color="primary" routerLink="/admin/offers/new">
      <mat-icon>add</mat-icon>
      New Offer
    </button>
  </div>

  <!-- Filters -->
  <mat-card class="mb-4">
    <mat-card-content>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <mat-form-field appearance="outline">
          <mat-label>Active Status</mat-label>
          <mat-select [value]="isActiveFilter()" (selectionChange)="isActiveFilter.set($event.value)">
            <mat-option [value]="undefined">All</mat-option>
            <mat-option [value]="true">Active</mat-option>
            <mat-option [value]="false">Inactive</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Validity</mat-label>
          <mat-select [value]="isValidFilter()" (selectionChange)="isValidFilter.set($event.value)">
            <mat-option [value]="undefined">All</mat-option>
            <mat-option [value]="true">Valid</mat-option>
            <mat-option [value]="false">Invalid</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Category</mat-label>
          <mat-select [value]="categoryFilter()" (selectionChange)="categoryFilter.set($event.value)">
            <mat-option [value]="">All Categories</mat-option>
            @for (category of categories(); track category.id) {
              <mat-option [value]="category.id">{{ category.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Product</mat-label>
          <mat-select [value]="productFilter()" (selectionChange)="productFilter.set($event.value)">
            <mat-option [value]="">All Products</mat-option>
            @for (product of products(); track product.id) {
              <mat-option [value]="product.id">{{ product.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="flex gap-2 mt-4">
        <button mat-button (click)="applyFilters()">Apply Filters</button>
        <button mat-button (click)="clearFilters()">Clear</button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Offers Table -->
  <mat-card>
    <mat-card-content>
      @if (loading()) {
        <div class="flex justify-center p-8">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
      } @else if (filteredOffers().length === 0) {
        <div class="text-center py-8 text-gray-500">No offers found</div>
      } @else {
        <table mat-table [dataSource]="filteredOffers()" class="w-full">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let offer">
              <div class="font-semibold">{{ offer.name }}</div>
              @if (offer.description) {
                <div class="text-sm text-gray-500">{{ offer.description }}</div>
              }
            </td>
          </ng-container>

          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef>Type</th>
            <td mat-cell *matCellDef="let offer">
              <mat-chip>{{ getOfferTypeLabel(offer.type) }}</mat-chip>
            </td>
          </ng-container>

          <ng-container matColumnDef="discountValue">
            <th mat-header-cell *matHeaderCellDef>Discount</th>
            <td mat-cell *matCellDef="let offer">
              @if (offer.type === OfferType.PercentageDiscount) {
                {{ offer.discountValue }}%
              } @else {
                â‚¹{{ offer.discountValue }}
              }
            </td>
          </ng-container>

          <ng-container matColumnDef="scope">
            <th mat-header-cell *matHeaderCellDef>Scope</th>
            <td mat-cell *matCellDef="let offer">{{ getScopeLabel(offer) }}</td>
          </ng-container>

          <ng-container matColumnDef="couponCode">
            <th mat-header-cell *matHeaderCellDef>Coupon Code</th>
            <td mat-cell *matCellDef="let offer">
              @if (offer.couponCode) {
                <mat-chip color="accent">{{ offer.couponCode }}</mat-chip>
              } @else {
                <span class="text-gray-400">Auto-apply</span>
              }
            </td>
          </ng-container>

          <ng-container matColumnDef="validity">
            <th mat-header-cell *matHeaderCellDef>Validity</th>
            <td mat-cell *matCellDef="let offer">
              <div class="text-sm">
                <div>{{ offer.startDate | date: 'shortDate' }}</div>
                <div class="text-gray-500">to {{ offer.endDate | date: 'shortDate' }}</div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="isActive">
            <th mat-header-cell *matHeaderCellDef>Active</th>
            <td mat-cell *matCellDef="let offer">
              <mat-chip [color]="offer.isActive ? 'primary' : 'warn'">
                {{ offer.isActive ? 'Yes' : 'No' }}
              </mat-chip>
            </td>
          </ng-container>

          <ng-container matColumnDef="isValid">
            <th mat-header-cell *matHeaderCellDef>Valid</th>
            <td mat-cell *matCellDef="let offer">
              <mat-chip [color]="offer.isValid ? 'primary' : 'warn'">
                {{ offer.isValid ? 'Yes' : 'No' }}
              </mat-chip>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let offer">
              <button mat-icon-button [routerLink]="['/admin/offers/edit', offer.id]" matTooltip="Edit">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button (click)="toggleActive(offer)" [matTooltip]="offer.isActive ? 'Deactivate' : 'Activate'">
                <mat-icon>{{ offer.isActive ? 'toggle_on' : 'toggle_off' }}</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteOffer(offer)" matTooltip="Delete">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      }
    </mat-card-content>
  </mat-card>
</div>

